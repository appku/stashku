<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
    <title>@AppKu/StashKu: engines/fetch-engine.js</title>
    
    
      <link type="text/css" rel="stylesheet" href="styles/vendor/prism-tomorrow-night.css">
    
    <link type="image/x-icon" rel="icon" href="favicon.ico">
    <link type="image/x-icon" rel="shortcut icon" href="favicon.ico">
    <link type="text/css" rel="stylesheet" href="styles/styles.css">
    
</head>
<body>

<header class="layout-header">
  
    <a href="./">
      <img
        src="https://avatars.githubusercontent.com/u/76977527?s=400"
        alt="@AppKu/StashKu"
      >
    </a>
  
  <h1><a href="./index.html">@AppKu/StashKu</a></h1>
  
  <h2>v1.0.18</h2>
  
  
  <ul class="meta-links">
    
    <li><a href="https://appku.com"><i class="bi bi-globe"></i></a></li>
    
    <li><a href="https://github.com/appku/stashku"><i class="bi bi-github"></i></a></li>
    
  </ul>
  
  <nav class="layout-nav">
    <ul class="nav-introduction">
      <li class="nav-item"><a href="./index.html">Introduction</a></li>
    </ul>
    <ul><li class="nav-heading">Tutorials</li><li class="nav-item"><a href="tutorial-Going Next-Level with Models.html">Going Next-Level with Models</a></li><li class="nav-item"><a href="tutorial-Requests_ DELETE.html">Requests: DELETE</a></li><li class="nav-item"><a href="tutorial-Requests_ GET.html">Requests: GET</a></li><li class="nav-item"><a href="tutorial-Requests_ OPTIONS.html">Requests: OPTIONS</a></li><li class="nav-item"><a href="tutorial-Requests_ PATCH.html">Requests: PATCH</a></li><li class="nav-item"><a href="tutorial-Requests_ POST.html">Requests: POST</a></li><li class="nav-item"><a href="tutorial-Requests_ PUT.html">Requests: PUT</a></li><li class="nav-item"><a href="tutorial-Using the CLI.html">Using the CLI</a></li><li class="nav-item"><a href="tutorial-Using the Fetch Engine.html">Using the Fetch Engine</a></li><li class="nav-item"><a href="tutorial-Using the Memory Engine.html">Using the Memory Engine</a></li><li class="nav-item"><a href="tutorial-Writing Your Own Engine.html">Writing Your Own Engine</a></li><li class="nav-item"><a href="tutorial-Writing Your Own Middleware.html">Writing Your Own Middleware</a></li></ul><ul><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="BaseEngine.html">BaseEngine</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="BaseEngine.html#config">config</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="BaseEngine.html#log">log</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="BaseEngine.html#name">name</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#options">options</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#patch">patch</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#post">post</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#put">put</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="BaseEngine.html#resources">resources</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="DeleteRequest.html">DeleteRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="DeleteRequest.html#method">method</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#all">all</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#count">count</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#from">from</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#headers">headers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="DeleteRequest.html#where">where</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="FetchEngine.html">FetchEngine</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="FetchEngine.html#config">config</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="FetchEngine.html#data">data</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#options">options</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#patch">patch</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#post">post</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#put">put</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="FetchEngine.html#resources">resources</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="Filter.html">Filter</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Filter.html#.LOGIC">LOGIC</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Filter.html#.OP">OP</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Filter.html#dot">dot</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Filter.html#tree">tree</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#.and">and</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#.fromObject">fromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#.isEmpty">isEmpty</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#.or">or</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#.parse">parse</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#add">add</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#and">and</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#clone">clone</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#or">or</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#test">test</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#toString">toString</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Filter.html#walk">walk</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="GetRequest.html">GetRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="GetRequest.html#method">method</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#count">count</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#distinct">distinct</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#from">from</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#headers">headers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#one">one</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#properties">properties</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#skip">skip</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#sort">sort</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#take">take</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="GetRequest.html#where">where</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="Logger.html">Logger</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Logger.html#callback">callback</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Logger.html#debug">debug</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Logger.html#error">error</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Logger.html#info">info</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Logger.html#warn">warn</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="Main.html">Main</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Main.html#cmd">cmd</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Main.html#state">state</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Main.html#configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Main.html#process">process</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Main.html#request">request</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="MemoryEngine.html">MemoryEngine</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="MemoryEngine.html#config">config</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="MemoryEngine.html#data">data</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#options">options</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#patch">patch</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#post">post</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#put">put</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#resourceOf">resourceOf</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="MemoryEngine.html#resources">resources</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="ModelGenerator.html">ModelGenerator</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelGenerator.html#.formatModelName">formatModelName</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelGenerator.html#.formatPropName">formatPropName</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelGenerator.html#.generateModelType">generateModelType</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="ModelUtility.html">ModelUtility</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.isValidType">isValidType</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.map">map</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.model">model</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.pk">pk</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.resource">resource</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.schema">schema</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.unmodel">unmodel</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.unmodelFilters">unmodelFilters</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="ModelUtility.html#.unmodelSorts">unmodelSorts</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="OptionsExporter.html">OptionsExporter</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsExporter.html#export">export</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsExporter.html#makePropertyJSDoc">makePropertyJSDoc</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsExporter.html#toJavascriptPropertyDefaultReference">toJavascriptPropertyDefaultReference</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsExporter.html#toJavaScriptString">toJavaScriptString</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="OptionsRequest.html">OptionsRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="OptionsRequest.html#method">method</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsRequest.html#all">all</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsRequest.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsRequest.html#from">from</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsRequest.html#headers">headers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="OptionsRequest.html#toJSON">toJSON</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="PatchRequest.html">PatchRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="PatchRequest.html#method">method</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#all">all</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#count">count</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#headers">headers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#template">template</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#to">to</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#toJSON">toJSON</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PatchRequest.html#where">where</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="PostRequest.html">PostRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="PostRequest.html#method">method</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PostRequest.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PostRequest.html#count">count</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PostRequest.html#headers">headers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PostRequest.html#objects">objects</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PostRequest.html#to">to</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PostRequest.html#toJSON">toJSON</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="PutRequest.html">PutRequest</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="PutRequest.html#method">method</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#clear">clear</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#count">count</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#headers">headers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#objects">objects</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#pk">pk</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#to">to</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="PutRequest.html#toJSON">toJSON</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="RequestProcessor.html">RequestProcessor</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="RequestProcessor.html#options">options</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="RequestProcessor.html#buildGet">buildGet</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="RequestProcessor.html#buildOptions">buildOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="RequestProcessor.html#start">start</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="Response.html">Response</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Response.html#affected">affected</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Response.html#code">code</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Response.html#data">data</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Response.html#returned">returned</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Response.html#total">total</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Response.html#.empty">empty</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Response.html#one">one</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="RESTError.html">RESTError</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="RESTError.html#code">code</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="Sort.html">Sort</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Sort.html#dir">dir</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="Sort.html#property">property</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Sort.html#.asc">asc</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Sort.html#.desc">desc</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Sort.html#.parse">parse</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="Sort.html#toString">toString</a></span></li><li class="nav-heading"><span class="nav-item-type type-class" title="class">C</span><span class="nav-item-name is-class"><a href="StashKu.html">StashKu</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="StashKu.html#config">config</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="StashKu.html#engine">engine</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="StashKu.html#log">log</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="StashKu.html#middleware">middleware</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="StashKu.html#stats">stats</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#.requestFromFile">requestFromFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#.requestFromObject">requestFromObject</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#configure">configure</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#destroy">destroy</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#get">get</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#http">http</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#middlerun">middlerun</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#model">model</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#options">options</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#patch">patch</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#post">post</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#put">put</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="StashKu.html#use">use</a></span></li></ul><ul><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-StringUtility.html">StringUtility</a></span></li></ul><ul><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="CLI.html">CLI</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="Filtering.html">Filtering</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="Modeling.html">Modeling</a></span></li></ul><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#ConditionCallback">ConditionCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#Constructor">Constructor</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#DeleteRequestCallback">DeleteRequestCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#FetchEngineConfiguration">FetchEngineConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#FetchEngineModelConfiguration">FetchEngineModelConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#GetRequestCallback">GetRequestCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="global.html#HttpRequestLoader">HttpRequestLoader</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="global.html#ISO8601Date">ISO8601Date</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#LoggerCallback">LoggerCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="global.html#LOGIC_KEYS">LOGIC_KEYS</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#MainState">MainState</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#MemoryEngineConfiguration">MemoryEngineConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#MemoryRequestHeader">MemoryRequestHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#ModelNameResolveCallback">ModelNameResolveCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="global.html#OP_MAP">OP_MAP</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#OptionsRequestCallback">OptionsRequestCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="global.html#PackageLoader">PackageLoader</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#ParserToken">ParserToken</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#PatchRequestCallback">PatchRequestCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#PostRequestCallback">PostRequestCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#PutRequestCallback">PutRequestCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#SortToken">SortToken</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="global.html#start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#StashKuConfiguration">StashKuConfiguration</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#StashKuMiddleware">StashKuMiddleware</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#StashKuMiddlewareCallback">StashKuMiddlewareCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#StashKuMiddlewareLogCallback">StashKuMiddlewareLogCallback</a></span></li><li class="nav-item"><span class="nav-item-type type-typedef" title="typedef">T</span><span class="nav-item-name is-typedef"><a href="global.html#StashKuModelConfiguration">StashKuModelConfiguration</a></span></li>
  </nav>
</header>


<main class="layout-main  layout-content--source">
  <div class="container">
    <p class="page-kind">source</p>
    <h1 class="page-title">engines/fetch-engine.js</h1>
    



    

<section>
    <article>
        <pre id="source" class="source-page line-numbers"><code class="language-js">import DeleteRequest from '../requests/delete-request.js';
import GetRequest from '../requests/get-request.js';
import OptionsRequest from '../requests/options-request.js';
import PatchRequest from '../requests/patch-request.js';
import PostRequest from '../requests/post-request.js';
import PutRequest from '../requests/put-request.js';
import Response from '../response.js';
import RESTError from '../rest-error.js';
import Filter from '../filter.js';
import Logger from '../logger.js';
import ModelGenerator from '../modeling/model-generator.js';
import BaseEngine from './base-engine.js';
import Sort from '../sort.js';

const IS_BROWSER = (typeof window !== 'undefined');
let GlobalFetch = null;
let GlobalFetchHeaders = null;
/* istanbul ignore next */
const lazyLoadGlobalFetch = async () => {
    if (!GlobalFetch) {
        if (IS_BROWSER) {
            GlobalFetch = window.fetch; // eslint-disable-line no-undef
            GlobalFetchHeaders = window.Headers; // eslint-disable-line no-undef
        } else if (fetch &amp;&amp; Headers) { // eslint-disable-line no-undef
            GlobalFetch = fetch; // eslint-disable-line no-undef
            GlobalFetchHeaders = Headers; // eslint-disable-line no-undef
        } else {
            let module = await import(/* webpackIgnore: true */'node-fetch');
            GlobalFetchHeaders = module.Headers;
            GlobalFetch = module.default;
        }
    }
};

/**
 * @typedef FetchEngineModelConfiguration
 * @property {String} [pathProperty="resource"] - Instructs StashKu which property from the `$stashku` object on
 * a model type to populate the resource (`to` or `from`) on a request. Can be `"name"`, `"slug"`, `"plural.name"`, 
 * `"plural.slug"`, or `"resource"` (default).
 * @property {Boolean} [header=false] - Determines whether the fetch request to the HTTP endpoint will include the
 * model header when `STASHKU_MODEL_HEADER` is enabled. By default this is disabled and the header `model` property
 * will *not* be sent. Setting this flag to `true` will forward the `model` header of the StashKu request.
 */

/**
 * @typedef FetchEngineConfiguration
 * @property {String} [root] - The root URI of each fetch request. If specified, will be prefixed to each resource.
 * @property {String} [path="/api"] - The path to the URI endpoint. This is prefixed before each resource, but after 
 * the `root` (if specified).
 * @property {Boolean} [trailingSlash=false] - Sets whether a slash will be added at the end of the generated URI.
 * @property {Boolean} [omitResource=false] - Omits `to` and `from` properties and values from the request payload
 * sent over fetch. This may help force endpoints to ensure the resource is determined on their end instead of by
 * the requestor.
 * @property {FetchEngineModelConfiguration} [model]
 * @property {RequestInit} [fetch] - Optional fetch defaults to apply before request-specific configuration is set.
 */

/**
 * This StashKu engine is built-in and provides an engine to make requests to HTTP endpoints using `fetch`. Requests 
 * correspond to their HTTP request method.
 */
class FetchEngine extends BaseEngine {
    /**
     * Creates a new `MemoryStorageEngine` instance.
     */
    constructor() {
        super('fetch');

        /**
         * @type {Map.&lt;String, Array>}
         */
        this.data = new Map();

        /**
         * @type {FetchEngineConfiguration}
         */
        this.config = {
            root: null,
            path: null,
            trailingSlash: false,
            omitResource: false
        };
    }

    /**
     * @inheritdoc
     * @param {FetchEngineConfiguration} config - The configuration object for the storage engine.
     */
    configure(config) {
        super.configure(config);
        let defaults = {
            root: null,
            path: null,
            trailingSlash: false
        };
        let modelDefaults = {
            header: false,
            pathProperty: 'resource'
        };
        if (IS_BROWSER === false || (typeof process !== 'undefined' &amp;&amp; typeof process.env === 'object')) {
            if (typeof process.env.STASHKU_FETCH_ROOT === 'string') {
                defaults.root = process.env.STASHKU_FETCH_ROOT;
            }
            if (typeof process.env.STASHKU_FETCH_PATH === 'string') {
                defaults.path = process.env.STASHKU_FETCH_PATH;
            }
            if (typeof process.env.STASHKU_FETCH_TRAILING_SLASH === 'string') {
                defaults.trailingSlash = !!process.env.STASHKU_FETCH_TRAILING_SLASH.match(/^[tTyY1]/);
            }
            if (typeof process.env.STASHKU_FETCH_OMIT_RESOURCE === 'string') {
                defaults.omitResource = !!process.env.STASHKU_FETCH_OMIT_RESOURCE.match(/^[tTyY1]/);
            }
            if (typeof process.env.STASHKU_FETCH_MODEL_HEADER === 'string') {
                modelDefaults.header = !!process.env.STASHKU_FETCH_MODEL_HEADER.match(/^[tTyY1]/);
            }
            if (typeof process.env.STASHKU_FETCH_MODEL_PATH_PROPERTY === 'string') {
                modelDefaults.pathProperty = process.env.STASHKU_FETCH_MODEL_PATH_PROPERTY;
            }
        }
        defaults = Object.assign(defaults, config);
        defaults.model = Object.assign({}, modelDefaults, defaults.model);
        //validate config
        if (this.config?.model?.pathProperty &amp;&amp; ['resource', 'name', 'slug', 'plural.name', 'plural.slug'].indexOf(this.config.model.pathProperty) &lt; 0) {
            throw new Error(`Invalid "model.pathProperty" configuration value "${this.config?.model?.pathProperty}". The value must be "resource", "name", "slug", "plural.name", or "plural.slug".`);
        }
        this.config = defaults;
    }

    /**
     * Serializes the given object into a query paramater (URL) string.
     * @param {*} obj - The object to be serialized
     * @param {String} [prefix] - When traversing an object, assign this prefix of the prior object key (recursive).
     * @returns {String}
     * @private
     */
    _paramSerialize(obj, prefix) {
        let str = [], p;
        for (p in obj) {
            if (typeof obj[p] !== 'undefined') {
                let k = prefix ? prefix + '[' + p + ']' : p,
                    v = obj[p];
                if (v !== null &amp;&amp; typeof v === 'object') {
                    if (v instanceof Date) {
                        str.push(encodeURIComponent(k) + '=' + encodeURIComponent(v.toISOString()));
                    } else {
                        str.push(this._paramSerialize(v, k));
                    }
                } else {
                    str.push(encodeURIComponent(k) + '=' + encodeURIComponent(v));
                }
            }
        }
        if (!str || str.length === 0) {
            return null;
        }
        return str.join('&amp;');
    }

    /**
     * Builds the full target URI for the fetch request based on engine settings.
     * The resource may be the literal resource target (string) or a model type.
     * 
     * @throws Error if the resource value is null or undefined.
     * @throws Error if a model type was specified but it is missing the resource value under the configured 
     * resource target.
     * @param {String} resourcePath - The resource (path).
     * @returns {String}
     * @private
     */
    _uri(resourcePath) {
        if (resourcePath === null || typeof resourcePath === 'undefined') {
            resourcePath = '';
        }
        let uri = [this.config.root, this.config.path, resourcePath].filter(v => typeof v === 'string').map(function (i) {
            return i.replace(/(^\/|\/$)/g, '');
        }).join('/');
        if (this.config.trailingSlash &amp;&amp; uri.endsWith('/') === false &amp;&amp; uri.indexOf('?') &lt; 0) {
            uri += '/';
        } else if (this.config.trailingSlash !== true &amp;&amp; uri.endsWith('/')) {
            uri = uri.substring(0, uri.length - 1);
        }
        if (uri.startsWith('/') === false &amp;&amp; !this.config.root &amp;&amp; !uri.match(/^.+\/\/+/)) {
            uri = '/' + uri;
        }
        return uri;
    }

    /**
     * Makes a fetch call to a remote endpoint and returns the response.
     * @param {String} resourcePath - The resource (path) to fetch.
     * @param {*} data - The data to be sent.
     * @param {RequestInit} settings - The `fetch` settings to apply.
     * @returns {Promise.&lt;globalThis.Response>}
     * @private
     */
    async _fetch(resourcePath, data, settings) {
        await lazyLoadGlobalFetch();
        settings = Object.assign({
            method: 'GET',
            cache: 'no-cache',
            headers: new GlobalFetchHeaders({
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            })
        }, this.config.fetch, settings);
        let targetURI = this._uri(resourcePath);
        settings.method = settings.method.toUpperCase(); //always upper
        if (data) {
            if (settings.method === 'GET') {
                let params = this._paramSerialize(data);
                if (params) {
                    targetURI += '?' + this._paramSerialize(data);
                }
            } else {
                if (!settings.headers) {
                    settings.headers = {};
                }
                settings.body = JSON.stringify(data);
            }
        }
        return GlobalFetch(targetURI, settings);
    }

    /**
     * Determines the resource path to use for the fetch request.
     * @param {DeleteRequest | GetRequest | PatchRequest | PostRequest | PutRequest | OptionsRequest} request - The 
     * StashKu request to extract the proper resource path from.
     * @returns {String}
     * @private
     */
    _getResourcePath(request) {
        let resource = null;
        if (this.config.model.pathProperty &amp;&amp; request.metadata.headers) {
            let modelHeader = request.metadata.headers.get('model');
            if (modelHeader) {
                switch (this.config.model.pathProperty) {
                    case 'name': resource = modelHeader.name; break;
                    case 'slug': resource = modelHeader.slug; break;
                    case 'plural.name': resource = modelHeader.plural.name; break;
                    case 'plural.slug': resource = modelHeader.plural.slug; break;
                }
            }
        }
        if (!resource) {
            resource = request.metadata.from || request.metadata.to;
        }
        return resource;
    }

    /**
     * @inheritdoc
     * @returns {Promise.&lt;Array.&lt;String>>}
     */
    async resources() {
        let res = await this._fetch('resources');
        let results = await res.json();
        return results.data;
    }

    /**
     * @override
     * @param {GetRequest} request - The GET request to send to the storage engine.
     * @returns {Promise.&lt;Response>} Returns the data objects from storage matching request criteria.
     */
    async get(request) {
        //validate
        await super.get(request);
        //make the request, wrap errors in RESTError
        let payload = request.toJSON();
        let resourcePath = this._getResourcePath(request);
        if (!this.config?.model?.header &amp;&amp; payload.headers) {
            delete payload.headers.model;
            if (Object.keys(payload.headers).length === 0) {
                delete payload.headers;
            }
        }
        if (this.config.omitResource) {
            delete payload.from;
        }
        let res = await this._fetch(resourcePath, payload);
        if (res.ok === false) {
            throw new RESTError(res.status, `Error from fetched resource ("${this._uri(request.metadata.from)}") in "${request.method}" request: ${res.statusText}`);
        }
        try {
            let payload = await res.json();
            return new Response(payload.data, payload.total, payload.affected, payload.returned, res.status);
        } catch (err) {
            throw new RESTError(500, `Error attempting to parse fetch response as JSON resource ("${this._uri(request.metadata.from)}") in "${request.method}" request: ${err.message}`, err);
        }
    }

    /**
     * @override
     * @param {PostRequest} request - The POST request to send to the storage engine.
     * @returns {Promise.&lt;Response>} Returns the data objects from storage that were created with the request criteria.
     */
    async post(request) {
        //validate
        await super.post(request);
        //process
        if (request.metadata.objects &amp;&amp; request.metadata.objects.length) {
            let payload = request.toJSON();
            let resourcePath = this._getResourcePath(request);
            if (!this.config?.model?.header &amp;&amp; payload.headers) {
                delete payload.headers.model;
                if (Object.keys(payload.headers).length === 0) {
                    delete payload.headers;
                }
            }
            if (this.config.omitResource) {
                delete payload.to;
            }
            //make the request, wrap errors in RESTError
            let res = await this._fetch(resourcePath, payload, { method: request.method });
            if (res.ok === false) {
                throw new RESTError(res.status, `Error from fetched resource ("${this._uri(request.metadata.to)}") in "${request.method}" request: ${res.statusText}`);
            }
            try {
                let payload = await res.json();
                return new Response(payload.data, payload.total, payload.affected, payload.returned, res.status);
            } catch (err) {
                throw new RESTError(500, `Error attempting to parse fetch response as JSON resource ("${this._uri(request.metadata.to)}") in "${request.method}" request: ${err.message}`, err);
            }
        }
        return Response.empty();
    }

    /**
     * @override
     * @param {PutRequest} request - The PUT request to send to the storage engine.
     * @returns {Promise.&lt;Response>} Returns the data objects from storage that were updated with the request criteria. This 
     * *__may not__* exactly match the objects requested to be updated, as some may have been deleted from storage or
     * some may not match the key criteria.
     */
    async put(request) {
        //validate
        await super.put(request);
        //process
        if (request.metadata.objects &amp;&amp; request.metadata.objects.length) {
            let payload = request.toJSON();
            let resourcePath = this._getResourcePath(request);
            if (!this.config?.model?.header &amp;&amp; payload.headers) {
                delete payload.headers.model;
                if (Object.keys(payload.headers).length === 0) {
                    delete payload.headers;
                }
            }
            if (this.config.omitResource) {
                delete payload.to;
            }
            //make the request, wrap errors in RESTError
            let res = await this._fetch(resourcePath, payload, { method: request.method });
            if (res.ok === false) {
                throw new RESTError(res.status, `Error from fetched resource ("${this._uri(request.metadata.to)}") in "${request.method}" request: ${res.statusText}`);
            }
            try {
                let payload = await res.json();
                return new Response(payload.data, payload.total, payload.affected, payload.returned, res.status);
            } catch (err) {
                throw new RESTError(500, `Error attempting to parse fetch response as JSON resource ("${this._uri(request.metadata.to)}") in "${request.method}" request: ${err.message}`, err);
            }
        }
        return Response.empty();
    }
    /**
     * @override
     * @param {PatchRequest} request - The PATCH request to send to the storage engine.
     * @returns {Promise.&lt;Response>} Returns a response with the total number of the objects affected in storage. No
     * data objects are typically returned with this request.
     */
    async patch(request) {
        //validate
        await super.patch(request);
        //process
        if (request.metadata.template) {
            let payload = request.toJSON();
            let resourcePath = this._getResourcePath(request);
            if (!this.config?.model?.header &amp;&amp; payload.headers) {
                delete payload.headers.model;
                if (Object.keys(payload.headers).length === 0) {
                    delete payload.headers;
                }
            }
            if (this.config.omitResource) {
                delete payload.to;
            }
            //make the request, wrap errors in RESTError
            let res = await this._fetch(resourcePath, payload, { method: request.method });
            if (res.ok === false) {
                throw new RESTError(res.status, `Error from fetched resource ("${this._uri(request.metadata.to)}") in "${request.method}" request: ${res.statusText}`);
            }
            try {
                let payload = await res.json();
                return new Response(payload.data, payload.total, payload.affected, payload.returned, res.status);
            } catch (err) {
                throw new RESTError(500, `Error attempting to parse fetch response as JSON resource ("${this._uri(request.metadata.to)}") in "${request.method}" request: ${err.message}`, err);
            }
        }
        return Response.empty();
    }

    /**
     * @override
     * @param {DeleteRequest} request - The DELETE request to send to the storage engine.
     * @returns {Promise.&lt;Response>} Returns the data objects from storage that were deleted with the request criteria.
     */
    async delete(request) {
        //validate
        await super.delete(request);
        //process
        if (request.metadata.all || (request.metadata.where &amp;&amp; Filter.isEmpty(request.metadata.where) === false)) {
            let payload = request.toJSON();
            let resourcePath = this._getResourcePath(request);
            if (!this.config?.model?.header &amp;&amp; payload.headers) {
                delete payload.headers.model;
                if (Object.keys(payload.headers).length === 0) {
                    delete payload.headers;
                }
            }
            if (this.config.omitResource) {
                delete payload.from;
            }
            //make the request, wrap errors in RESTError
            let res = await this._fetch(resourcePath, payload, { method: request.method });
            if (res.ok === false) {
                throw new RESTError(res.status, `Error from fetched resource ("${this._uri(request.metadata.from)}") in "${request.method}" request: ${res.statusText}`);
            }
            try {
                let payload = await res.json();
                return new Response(payload.data, payload.total, payload.affected, payload.returned, res.status);
            } catch (err) {
                throw new RESTError(500, `Error attempting to parse fetch response as JSON resource ("${this._uri(request.metadata.from)}") in "${request.method}" request: ${err.message}`, err);
            }
        }
        return Response.empty();
    }

    /**
     * @override
     * @param {OptionsRequest} request - The OPTIONS request to send to the storage engine.
     * @returns {Promise.&lt;Response>} Returns a response with a single data object- the dynamically created model
     * configuration.
     */
    async options(request) {
        //validate
        await super.options(request);
        //process
        let payload = request.toJSON();
        let resourcePath = this._getResourcePath(request);
        if (!this.config?.model?.header &amp;&amp; payload.headers) {
            delete payload.headers.model;
            if (Object.keys(payload.headers).length === 0) {
                delete payload.headers;
            }
        }
        //make the request, wrap errors in RESTError
        let res = await this._fetch(resourcePath, payload, { method: request.method });
        if (res.ok === false) {
            throw new RESTError(res.status, `Error from fetched resource ("${this._uri(request.metadata.from)}") in "${request.method}" request: ${res.statusText}`);
        }
        try {
            let payload = await res.json();
            return new Response(payload.data, payload.total, payload.affected, payload.returned, res.status);
        } catch (err) {
            throw new RESTError(500, `Error attempting to parse fetch response as JSON resource ("${this._uri(request.metadata.from)}") in "${request.method}" request: ${err.message}`, err);
        }
    }

}

export default FetchEngine;</code></pre>
    </article>
</section>




  </div>
</main>

<footer class="layout-footer">
  <div class="container">
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.10</a> on Wed Jun 08 2022 18:23:30 GMT-0700 (Pacific Daylight Time)
  </div>
</footer>



<script src="scripts/prism.dev.js"></script>
</body>
</html>
